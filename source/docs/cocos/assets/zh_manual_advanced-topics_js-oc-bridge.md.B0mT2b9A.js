import{_ as s,c as i,o as a,a5 as n}from"./chunks/framework.CqnjdYks.js";const o=JSON.parse('{"title":"使用 JsbBridge 实现 JavaScript 与 Objective-C 通信","description":"","frontmatter":{},"headers":[],"relativePath":"zh/manual/advanced-topics/js-oc-bridge.md","filePath":"zh/manual/advanced-topics/js-oc-bridge.md"}'),t={name:"zh/manual/advanced-topics/js-oc-bridge.md"},h=n(`<h1 id="使用-jsbbridge-实现-javascript-与-objective-c-通信" tabindex="-1">使用 JsbBridge 实现 JavaScript 与 Objective-C 通信 <a class="header-anchor" href="#使用-jsbbridge-实现-javascript-与-objective-c-通信" aria-label="Permalink to &quot;使用 JsbBridge 实现 JavaScript 与 Objective-C 通信&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p><a href="./oc-reflection.html">基于反射机制实现 JavaScript 与 iOS/macOS 系统原生通信</a> 的方法中，我们不仅需要严格声明包名和函数签名，还需要严格校对参数数量以确保正常运行，步骤较为复杂。</p><p>因此我们额外提供了另外一种方法，用于简化脚本层到原生层的调用。这是一种通道，或者说是一个桥梁，我们将其命名为 <code>JsbBridge</code>，意为通过 <code>JSB</code> 绑定作为沟通脚本和原生 APP 的桥梁。</p><blockquote><p><strong>注意</strong>：两种方式都是可以正常使用的，开发者可以根据实际需要选择使用。</p></blockquote><h2 id="调用机制" tabindex="-1">调用机制 <a class="header-anchor" href="#调用机制" aria-label="Permalink to &quot;调用机制&quot;">​</a></h2><h3 id="javascript-接口介绍" tabindex="-1">JavaScript 接口介绍 <a class="header-anchor" href="#javascript-接口介绍" aria-label="Permalink to &quot;JavaScript 接口介绍&quot;">​</a></h3><p>在脚本层只有 <code>sendToNative</code> 和 <code>onNative</code> 两个接口，定义如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// JavaScript</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bridge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Send to native with at least one argument.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendToNative</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Save your own callback controller with a JavaScript function,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Use &#39;jsb.bridge.onNative = (arg0: String, arg1: String | null)=&gt;{...}&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> : received from native</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onNative</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>见名知义，<code>sendToNative</code> 用于调用原生层的代码，而 <code>onNative</code> 用于响应原生层的调用。</p><p>使用时需要注意以下几点：</p><ul><li>由于现在这个功能还在实验阶段，所以只支持 <code>string</code> 的传输，如果需要传输包含多种参数的对象，请考虑将其转化为 <code>Json</code> 形式进行传输，并在不同层级解析。</li><li><code>onNative</code> 同一时间只会记录一个函数，当再次 <code>set</code> 该属性时会覆盖原先的 <code>onNative</code> 方法。</li><li><code>sendToScript</code> 方法是单向通信，不会关心下层的返回情况，也不会告知 <code>JavaScript</code> 操作成功或者失败。开发者需要自行处理操作情况。</li></ul><h3 id="objective-c-接口介绍" tabindex="-1">Objective-C 接口介绍 <a class="header-anchor" href="#objective-c-接口介绍" aria-label="Permalink to &quot;Objective-C 接口介绍&quot;">​</a></h3><p>在 <code>Objective-C</code> 中，也有两对应的接口， <code>sendToScript</code> 和 <code>callByScript</code>，定义如下：</p><div class="language-objc vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">objc</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//Objective-c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ICallback)(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsbBridge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NSObject</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instancetype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sharedInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCallback:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ICallback)cb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">callByScript:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg0 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arg1:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendToScript:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg0 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">arg1:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendToScript:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg0;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@end</span></span></code></pre></div><p>其中 <code>sendToScript</code> 用于调用脚本层代码，而 <code>callByScript</code> 用于响应脚本层的调用。</p><p>我们需要实现 <code>ICallback</code> 接口，并且使用 <code>setCallback</code> 注册，来响应 <code>callByScript</code> 的具体行为。</p><h2 id="基本使用" tabindex="-1">基本使用 <a class="header-anchor" href="#基本使用" aria-label="Permalink to &quot;基本使用&quot;">​</a></h2><h3 id="javascript-触发-objective-c-的回调" tabindex="-1">JavaScript 触发 Objective-C 的回调 <a class="header-anchor" href="#javascript-触发-objective-c-的回调" aria-label="Permalink to &quot;JavaScript 触发 Objective-C 的回调&quot;">​</a></h3><p>假设我们用 Objective-C 写了一个打开广告的接口，当玩家点击打开广告的按钮时，应该由 JavaScript 调用对应的 Objective-C 接口，触发打开广告的操作。</p><p>我们需要先实现一个 ICallback 接口，用于响应操作，然后通过 <code>setCallback</code> 方法，注册到 <code>JsbBridge</code>。</p><p>Objective-C 代码如下：</p><div class="language-ObjC vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ObjC</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;platform/apple/JsbBridge.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ICallback cb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _arg0, MSString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _arg1){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([_arg0 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isEqual:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@&quot;open_ad&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //open Ad</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JsbBridge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [JsbBridge </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sharedInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[m </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setCallback:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cb];</span></span></code></pre></div><p>在 JavaScript 脚本中，我们就可以像下面一样调用：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { native } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cc&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">public static </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onclick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    native.bridge.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendToNative</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;open_ad&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, defaultAdUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="objective-c-触发-javascript-的回调" tabindex="-1">Objective-C 触发 JavaScript 的回调 <a class="header-anchor" href="#objective-c-触发-javascript-的回调" aria-label="Permalink to &quot;Objective-C 触发 JavaScript 的回调&quot;">​</a></h3><p>假设我们的广告播放完成后，需要通知 JavaScript 层，可以像下面这样操作。</p><p>首先，需要在 JavaScript 使用 <code>onNative</code> 响应事件：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">native.bridge.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onNative</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ad_close&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;finished&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //ad playback completed.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //ad cancel.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>然后，在 <code>Objective-C</code> 中，用如下代码调用：</p><div class="language-ObjC vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ObjC</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;platform/apple/JsbBridge.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JsbBridge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [JsbBridge </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sharedInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[m </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sendToScript:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@&quot;ad_close&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arg1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@&quot;finished&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><p>通过上述操作，便可以通知 JavaScript 广告的播放结果了。</p><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><p>JsbBridge 提供了 arg0 和 arg1 两个 string 类型的参数用于传递信息，可以根据不同的需求进行分配。</p><h3 id="_1-arg0-和-arg1-均用于参数" tabindex="-1">1. arg0 和 arg1 均用于参数 <a class="header-anchor" href="#_1-arg0-和-arg1-均用于参数" aria-label="Permalink to &quot;1. arg0 和 arg1 均用于参数&quot;">​</a></h3><p>如果通信需求比较简单，不需要进行分类处理，则可以将 arg0 和 arg1 用作参数传递。</p><h3 id="_2-arg0-用于分类标记-arg1-用于参数" tabindex="-1">2. arg0 用于分类标记, arg1 用于参数 <a class="header-anchor" href="#_2-arg0-用于分类标记-arg1-用于参数" aria-label="Permalink to &quot;2. arg0 用于分类标记, arg1 用于参数&quot;">​</a></h3><p>如果通信需求相对复杂，可以使用 arg0 作为分类标记，根据 arg0 来分类处理， arg1 用于参数传递</p><h3 id="_3-arg0-用于分类标记-arg1-作为-json-字符串" tabindex="-1">3. arg0 用于分类标记，arg1 作为 JSON 字符串 <a class="header-anchor" href="#_3-arg0-用于分类标记-arg1-作为-json-字符串" aria-label="Permalink to &quot;3. arg0 用于分类标记，arg1 作为 JSON 字符串&quot;">​</a></h3><p>对于特别复杂的需求， 单纯的 string 类型参数无法满足，此时可以将需要传递的对象通过 <code>JSON.stringfy</code> 转化为字符串，再通过 arg1 进行传递。 使用时，再利用 <code>JSON.parse</code> 还原为对象，做后续的处理。</p><blockquote><p>由于涉及到 JSON 的序列化和反序列化操作，这种使用方式不建议高频调用。</p></blockquote><h2 id="线程安全" tabindex="-1">线程安全 <a class="header-anchor" href="#线程安全" aria-label="Permalink to &quot;线程安全&quot;">​</a></h2><p>注意，如果相关代码涉及到原生 UI 的部分，就需要考虑线程安全问题，详情请参考：<a href="./thread-safety.html">线程安全</a>。</p><h2 id="示例工程-简单的多事件调用" tabindex="-1">示例工程：简单的多事件调用 <a class="header-anchor" href="#示例工程-简单的多事件调用" aria-label="Permalink to &quot;示例工程：简单的多事件调用&quot;">​</a></h2><p>Cocos Creator 提供了 <strong>native-script-bridge</strong>（<a href="https://github.com/cocos-creator/example-3d/tree/v3.7/native-script-bridge" target="_blank" rel="noreferrer">GitHub</a> | <a href="https://gitee.com/mirrors_cocos-creator/example-3d/tree/v3.7/native-script-bridge" target="_blank" rel="noreferrer">Gitee</a>）范例，开发者可根据需要自行下载以参考使用。</p>`,45),l=[h];function e(p,k,r,d,g,c){return a(),i("div",null,l)}const y=s(t,[["render",e]]);export{o as __pageData,y as default};
