import{_ as i,c as s,o as a,a4 as e}from"./chunks/framework.uQk9_EO2.js";const g=JSON.parse('{"title":"v3.5 Built Project Upgrade Guide to v3.6","description":"","frontmatter":{},"headers":[],"relativePath":"en/engine/template/native-upgrade-to-v3.6.md","filePath":"en/engine/template/native-upgrade-to-v3.6.md","lastUpdated":1712305443000}'),t={name:"en/engine/template/native-upgrade-to-v3.6.md"},n=e(`<h1 id="v3-5-built-project-upgrade-guide-to-v3-6" tabindex="-1">v3.5 Built Project Upgrade Guide to v3.6 <a class="header-anchor" href="#v3-5-built-project-upgrade-guide-to-v3-6" aria-label="Permalink to &quot;v3.5 Built Project Upgrade Guide to v3.6&quot;">​</a></h1><p>This article details the considerations for upgrading Cocos Creator native builds from 3.5.0 ~ 3.5.x to 3.6. The changes are only for the native directory under the project.</p><h2 id="build" tabindex="-1">Build <a class="header-anchor" href="#build" aria-label="Permalink to &quot;Build&quot;">​</a></h2><p>Open the old version of the project with the new version of the engine, and then build the target platform after the upgrade is completed. To avoid upgrade failure, please backup the project first, and then follow the steps below to upgrade.</p><h2 id="android" tabindex="-1">Android <a class="header-anchor" href="#android" aria-label="Permalink to &quot;Android&quot;">​</a></h2><h3 id="file-modification" tabindex="-1">File modification <a class="header-anchor" href="#file-modification" aria-label="Permalink to &quot;File modification&quot;">​</a></h3><ul><li>Delete file: jni/main.cpp</li><li>android/CMakeLists.txt: delete <code>\${CMAKE_CURRENT_LIST_DIR}/jni/main.cpp</code></li></ul><h3 id="compile-changes" tabindex="-1">Compile changes <a class="header-anchor" href="#compile-changes" aria-label="Permalink to &quot;Compile changes&quot;">​</a></h3><p>To reduce the package size, the default value of <code>CMAKE_C_FLAGS_RELEASE</code> and <code>CMAKE_CXX_FLAGS_RELEASE</code> compiler parameter <code>visibility</code> has been changed from <code>default</code> to <code>hidden</code>. For this change, if the interface is not found in the release version of <code>jni</code>, please check if the interface has the declaration <code>JNIEXPORT</code> added. For example.</p><ul><li><p>Old Code</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Java_com_google_android_games_paddleboat_GameControllerManager_onMouseConnected</span></span></code></pre></div></li><li><p>Modified</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JNIEXPORT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JNICALL Java_com_google_android_games_paddleboat_GameControllerManager_onMouseConnected</span></span></code></pre></div></li></ul><h2 id="code-modification" tabindex="-1">Code modification <a class="header-anchor" href="#code-modification" aria-label="Permalink to &quot;Code modification&quot;">​</a></h2><ul><li><p>Projects with custom jsb interfaces: code related to <code>NonRefNativePtrCreatedByCtorMap</code> must be removed</p></li><li><p>Manually written JSB <code>_finalize</code> functions should be set to empty, please refer the <a href="./../../advanced-topics/JSB2.0-learning#c++-object-lifecycle-management">Tutorial: JSB 2.0</a>.</p><p>For example:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> js_cc_gfx_Size_finalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">se</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // NOLINT(readability-identifier-naming)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> se</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NonRefNativePtrCreatedByCtorMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SE_THIS_OBJECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gfx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(s));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> se</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NonRefNativePtrCreatedByCtorMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        se</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NonRefNativePtrCreatedByCtorMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">erase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iter);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        auto*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cobj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SE_THIS_OBJECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gfx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(s);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        JSB_FREE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cobj);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SE_BIND_FINALIZE_FUNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(js_cc_gfx_Size_finalize)</span></span></code></pre></div><p>Remove all operations.</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> js_cc_gfx_Size_finalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">se</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // NOLINT(readability-identifier-naming)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SE_BIND_FINALIZE_FUNC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(js_cc_gfx_Size_finalize)</span></span></code></pre></div></li></ul><h2 id="scripting-considerations" tabindex="-1">Scripting Considerations <a class="header-anchor" href="#scripting-considerations" aria-label="Permalink to &quot;Scripting Considerations&quot;">​</a></h2><p>Since the implementation of Native engines differs slightly from that of non-Native engines, developers must be aware of these differences, which are organized as follows.</p><ul><li><p><code>Readonly</code>: On Native platforms, properties are fetched as newly created objects in order to reduce memory usage.</p><p>The description of <code>Readonly</code> can be found in <a href="./../../scripting/readonly#readonly">Development Notes - ReaOnly</a></p></li></ul>`,15),l=[n];function h(p,d,k,r,o,c){return a(),s("div",null,l)}const y=i(t,[["render",h]]);export{g as __pageData,y as default};
