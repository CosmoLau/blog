import{_ as s,v as a,b as n,R as l}from"./chunks/framework.5ffcbaff.js";const C=JSON.parse('{"title":"include 机制","description":"","frontmatter":{},"headers":[],"relativePath":"zh/manual/shader/surface-shader/includes.md","filePath":"zh/manual/shader/surface-shader/includes.md"}'),e={name:"zh/manual/shader/surface-shader/includes.md"},p=l(`<h1 id="include-机制" tabindex="-1">include 机制 <a class="header-anchor" href="#include-机制" aria-label="Permalink to &quot;include 机制&quot;">​</a></h1><h2 id="头文件" tabindex="-1">头文件 <a class="header-anchor" href="#头文件" aria-label="Permalink to &quot;头文件&quot;">​</a></h2><p>Surface Shader 中，包含了多个<a href="./lighting-mode.html">光照模型</a>，如 standard，toon 等。</p><p>同时，我们拥有不同的<a href="./render-usage.html">渲染用途</a>，如 render-to-scene， render-to-shadowmap 等。</p><p>不同的光照模型拥有不同的表面材质数据结构和光照计算函数，不同的渲染用途之间，流程上会有细微的差别。</p><p>如果为不同的光照模型和不同的渲染用途编写独立的代码，会使整个架构很难维护。</p><p>因此，在 Surface Shader 中，我们将不同光照模型的方法和结构体，以相同的名字定义在不同的头文件中，<strong>再使用 include 进行组合</strong>。</p><p>这样就可以很容易实现，在同样的流程下，通过切换头文件实现不同的光照模型。</p><p>比如，在下面的代码中，我们通过 <strong>#include &lt;surfaces/data-structures/standard&gt;</strong> 引入 <strong>SurfacesMaterialData</strong> 的定义，函数中使用的结构体，就是 PBR 表面材质数据结构体。</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//PBR 表面材质</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">surfaces/data-structures/standard</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CC_SURFACES_FRAGMENT_MODIFY_SHARED_DATA</span></span>
<span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SurfacesFragmentModifySharedData</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">inout SurfacesMaterialData </span><span style="color:#A6ACCD;font-style:italic;">surfaceData</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// set user-defined data to surfaceData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>如果我们更换它的头文件：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//toom 表面材质</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">surfaces/data-structures/toon</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CC_SURFACES_FRAGMENT_MODIFY_SHARED_DATA</span></span>
<span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SurfacesFragmentModifySharedData</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">inout SurfacesMaterialData </span><span style="color:#A6ACCD;font-style:italic;">surfaceData</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// set user-defined data to surfaceData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>此时的 SurfacesMaterialData 使用的就是 surfaces/data-structures/toon 中定义的结构体。</p><h2 id="ccprogram" tabindex="-1">CCProgram <a class="header-anchor" href="#ccprogram" aria-label="Permalink to &quot;CCProgram&quot;">​</a></h2><p>在 Surface Shader 中，CCProgram 包含的内容就是纯粹的 GLSL 代码内容。 我们可以将 Shader 分割到不同的 CCProgram 里形成代码片段，然后通过 <code>include</code> 进行引用。</p><p>以下面代码为例：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">CCProgram shared</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ubos </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span>
<span class="line"><span style="color:#A6ACCD;">CCProgram macro</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">remampping </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CCProgram vs </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">shared</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ubos</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">macro</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">remapping</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CCProgram fs </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">shared</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ubos</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">macro</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">remapping</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span></code></pre></div><blockquote><p>注意：使用 <code>include</code> 引用 <code>CCProgram</code> 定义的代码片段时，仅限本文件内。</p></blockquote>`,18),o=[p];function t(c,r,i,D,y,F){return a(),n("div",null,o)}const u=s(e,[["render",t]]);export{C as __pageData,u as default};
