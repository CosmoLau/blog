import{_ as e,c as t,o as n,a4 as i}from"./chunks/framework.uQk9_EO2.js";const o="/docs/cocos/assets/engine-core-architecture.BziVtG7V.png",a="/docs/cocos/assets/select-repo.DcyqfUuw.png",s="/docs/cocos/assets/download-repo.DWkVsUE5.png",r="/docs/cocos/assets/download-external-zip.ClCZ7_Mj.png",c="/docs/cocos/assets/custom-engine.C7E5ZGzq.png",l="/docs/cocos/assets/custom-engine-store-path.ncDn8y0n.png",h="/docs/cocos/assets/use-native-engine-for-editor.DK5p6JN3.png",d="/docs/cocos/assets/build-ts-engine.2SBcG-Zl.png",p="/docs/cocos/assets/custom-native-simulator.h2i7PK-n.png",q=JSON.parse('{"title":"Engine Customization Workflow","description":"","frontmatter":{},"headers":[],"relativePath":"en/advanced-topics/engine-customization.md","filePath":"en/advanced-topics/engine-customization.md","lastUpdated":1712305443000}'),g={name:"en/advanced-topics/engine-customization.md"},u=i('<h1 id="engine-customization-workflow" tabindex="-1">Engine Customization Workflow <a class="header-anchor" href="#engine-customization-workflow" aria-label="Permalink to &quot;Engine Customization Workflow&quot;">​</a></h1><p>Cocos Creator has two engine kernels: C++ kernel and TypeScript kernel. The C++ kernel is used for native platforms, while the TypeScript kernel is used for web and mini-game platforms. On top of the engine kernels is the engine framework layer written in TypeScript, which aims to unify the differences between the two kernels and make development more convenient.</p><p><img src="'+o+'" alt="engine-core"></p><h2 id="getting-the-engine-source-code" tabindex="-1">Getting the Engine Source Code <a class="header-anchor" href="#getting-the-engine-source-code" aria-label="Permalink to &quot;Getting the Engine Source Code&quot;">​</a></h2><p><img src="'+a+'" alt="download repo js"></p><h3 id="_1-accessing-the-cocos-engine-repository" tabindex="-1">1. Accessing the Cocos Engine Repository <a class="header-anchor" href="#_1-accessing-the-cocos-engine-repository" aria-label="Permalink to &quot;1. Accessing the Cocos Engine Repository&quot;">​</a></h3><p>Cocos is an open-source engine, and you can obtain different versions of the engine source code from the official Cocos Engine repository. The repository links are as follows:</p><ul><li>cocos/cocos-engine：<a href="https://github.com/cocos/cocos-engine/" target="_blank" rel="noreferrer">GitHub</a></li></ul><p>Open the repository homepage, and you will see the content shown in the left sub-figure of the above image. You can decide which version to use based on your requirements.</p><h3 id="_2-selecting-a-branch" tabindex="-1">2. Selecting a Branch <a class="header-anchor" href="#_2-selecting-a-branch" aria-label="Permalink to &quot;2. Selecting a Branch&quot;">​</a></h3><p>If you want to use the latest branch, select the &quot;develop&quot; branch as shown in the middle sub-figure of the image.</p><blockquote><p><strong>Note:</strong> This branch is the latest in-developing branch and may not guarantee stability.</p></blockquote><h3 id="selecting-a-tag" tabindex="-1">Selecting a Tag <a class="header-anchor" href="#selecting-a-tag" aria-label="Permalink to &quot;Selecting a Tag&quot;">​</a></h3><p>If you want to use a tag (a stable branch) corresponding to a specific version of Cocos Creator, follow the steps shown in the right sub-figure of the image. Switch to the &quot;Tags&quot; tab and select the desired version. For example, if you are using Cocos Creator 3.7.3, select version 3.7.3.</p><blockquote><p><strong>Note:</strong> Different versions of Cocos Creator require corresponding engine branches or tags. Make sure the versions match.</p></blockquote><h3 id="_3-clone-download" tabindex="-1">3. Clone/Download <a class="header-anchor" href="#_3-clone-download" aria-label="Permalink to &quot;3. Clone/Download&quot;">​</a></h3><p><img src="'+s+`" alt="download-repo"></p><p>As shown in the image above, after selecting the appropriate branch or tag, you will be in the corresponding repository (1).</p><p>Click on the &quot;Code&quot; button on the right (2) to open the code-getting panel.</p><p>You can either copy the repository link (3) and clone it to local using Git, or choose <strong>Download ZIP</strong>(4) to download the source code as a ZIP file and extract it in your disk.</p><blockquote><p>Don&#39;t forget to give a star to the Cocos Engine repository in the top right corner (5). Thank you!</p></blockquote><h2 id="configuring-development-environment" tabindex="-1">Configuring Development Environment <a class="header-anchor" href="#configuring-development-environment" aria-label="Permalink to &quot;Configuring Development Environment&quot;">​</a></h2><h3 id="_1-placing-the-engine-source-code-in-a-specified-directory" tabindex="-1">1. Placing the Engine Source Code in a Specified Directory <a class="header-anchor" href="#_1-placing-the-engine-source-code-in-a-specified-directory" aria-label="Permalink to &quot;1. Placing the Engine Source Code in a Specified Directory&quot;">​</a></h3><p>Obtain the specific version of cocos-engine source code from the Cocos Engine repository according to your project&#39;s needs and place it in a suitable directory.</p><ul><li>If the custom engine is only used for a specific project, it is recommended to put it in the project directory.</li><li>If multiple projects will share the same custom engine, place it in a suitable shared directory based on your project management approach.</li></ul><h3 id="_2-downloading-external" tabindex="-1">2. Downloading external <a class="header-anchor" href="#_2-downloading-external" aria-label="Permalink to &quot;2. Downloading external&quot;">​</a></h3><p>The compilation of the Cocos native engine depends on the libraries in <code>cocos-engine/native/external/</code>. These libraries are several hundred megabytes in size and are not included by default in the source code package. You can obtain them in the following three ways:</p><p><strong>The First Way:</strong> Use git command-line</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cd cocos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">native</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  git clone </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//github.com/cocos/cocos-engine-external external</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cd external</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  git checkout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b branch_name tag</span></span></code></pre></div><ul><li>branch_name：The new branch name</li><li>tag：The tag name corresponding to the third-party library. You can get it from the <code>checkout</code> field in <code>cocos-engine/native/external-config.json</code> file.</li></ul><blockquote><p>Example: If we want to use version 3.7.1-1, it can be written as <code>git checkout -b 3.7.3-1 3.7.3-1</code></p></blockquote><p><strong>The Second Way:</strong> Use gulp</p><p>The following shell will only download the third-party libraries corresponding to the specific tag.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cd cocos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">native</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  npm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gulp init</span></span></code></pre></div><blockquote><p>Whenever the used tag changes, you need to download it again. It requires downloading several hundred megabytes of content each time.</p></blockquote><p><strong>The Third Way:</strong> Download the ZIP package</p><p>If, for some reason, you cannot download the <code>external</code> source code package using <code>NodeJS</code> and <code>git commands</code>, you can directly download it from the <a href="https://github.com/cocos/cocos-engine-external" target="_blank" rel="noreferrer">cocos-engine-external repository</a> by following these steps.</p><p><img src="`+r+`" alt="download-external-zip"></p><ol><li>Select the corresponding tag. You can check which one to use from the <code>checkout</code> field of <code>cocos-engine/native/external-config.json</code>.</li><li>Click the <strong>Code</strong> button on the right to open the code-getting panel.</li><li>Click the <strong>Download ZIP</strong> button to download the source code as a ZIP package.</li><li>Exact the package, rename it to <code>external</code>, and place it in the <code>cocos-engine/native</code> folder.</li></ol><blockquote><p><strong>Note:</strong> The version of <code>external</code> and <code>cocos-engine</code> must match, otherwise, it may result in compilation errors.</p></blockquote><h3 id="_3-installing-compilation-dependencies" tabindex="-1">3. Installing Compilation Dependencies <a class="header-anchor" href="#_3-installing-compilation-dependencies" aria-label="Permalink to &quot;3. Installing Compilation Dependencies&quot;">​</a></h3><p>The compilation dependencies require <code>NodeJS</code>. Make sure you have installed <code>NodeJS v12.0</code> or above on your computer. If not, please download and install it from <a href="https://nodejs.org/" target="_blank" rel="noreferrer">https://nodejs.org/</a>.</p><p>After installation, navigate to the root directory of the custom engine and execute the following commands:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install gulp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gulp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install the required modules</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><h3 id="_4-modifying-the-engine-path" tabindex="-1">4. Modifying the Engine Path <a class="header-anchor" href="#_4-modifying-the-engine-path" aria-label="Permalink to &quot;4. Modifying the Engine Path&quot;">​</a></h3><p>Use the <strong>Cocos Creator/File -&gt; Preferences -&gt; Engine Manager</strong> tab to set the path to the engine source code. Note that <strong>you need to restart the editor after modifying the engine path</strong>.</p><p><img src="`+c+'" alt="custom ts engine"></p><h4 id="specifying-the-typescript-engine" tabindex="-1">Specifying the TypeScript Engine <a class="header-anchor" href="#specifying-the-typescript-engine" aria-label="Permalink to &quot;Specifying the TypeScript Engine&quot;">​</a></h4><p>By default, the <code>Use Built-in</code> option is selected, indicating that the built-in engine of Cocos Creator is being used. To use the custom engine, switch to the <code>Use Custom</code> tab and specify the path to the engine source code root directory.</p><h4 id="specifying-the-native-c-engine" tabindex="-1">Specifying the Native（C++）Engine <a class="header-anchor" href="#specifying-the-native-c-engine" aria-label="Permalink to &quot;Specifying the Native（C++）Engine&quot;">​</a></h4><p>If you need to customize the engine functionality related to native platforms, you also need to check the <code>Use Custom</code> option under <code>Native Module</code>. It will automatically recognize the <code>native</code> folder under the custom engine&#39;s root directory as the path, which cannot be changed.</p><h4 id="modifying-the-storage-location" tabindex="-1">Modifying the Storage Location <a class="header-anchor" href="#modifying-the-storage-location" aria-label="Permalink to &quot;Modifying the Storage Location&quot;">​</a></h4><p><img src="'+l+'" alt="custom-engine-store-path"></p><p>By default, modifications to the engine path are saved as global configurations, which will affect all projects using the current version of Cocos Creator.</p><p>Hover your mouse over the &quot;Cocos Engine&quot; text, and a settings button will appear in front of the text. Click on the button to select a storage location.</p><h4 id="relaunching-cocos-creator" tabindex="-1">Relaunching Cocos Creator <a class="header-anchor" href="#relaunching-cocos-creator" aria-label="Permalink to &quot;Relaunching Cocos Creator&quot;">​</a></h4><p>After modifying the engine path, you need to restart Cocos Creator editor for the changes to take effect. You can either close Cocos Creator and open it again or click on the Relaunch button on the panel.</p><p><strong>Note:</strong> Once the custom engine is in working, the scene editor in Cocos Creator will also use the custom engine for rendering. By default, it uses the TypeScript kernel. If you want the editor to use the native engine for rendering as well, you need to enable the <code>Use native engine for scene editor</code> option in the <strong>Preferences -&gt; Laboratory</strong> panel.</p><p><img src="'+h+'" alt="use-native-engine-for-editor"></p><h2 id="modifying-the-typescript-engine" tabindex="-1">Modifying the TypeScript Engine <a class="header-anchor" href="#modifying-the-typescript-engine" aria-label="Permalink to &quot;Modifying the TypeScript Engine&quot;">​</a></h2><p>If you only need to customize the engine functionality for web and mini-game platforms or modify the TypeScript modules of the engine (such as the UI system, animation system, etc.), you only need to compile the engine by clicking <strong>Developer -&gt; Compile the Engine</strong> on the menu bar of Cocos Creator.</p><p><img src="'+d+'" alt="build"></p><p>This command will generate a bin folder under the engine directory and compile the engine source code there.</p><h2 id="modifying-the-native-c-engine" tabindex="-1">Modifying the Native (C++) Engine <a class="header-anchor" href="#modifying-the-native-c-engine" aria-label="Permalink to &quot;Modifying the Native (C++) Engine&quot;">​</a></h2><p>If you need to customize the engine functionality related to native platforms, in addition to modifying the TypeScript code, you may also need to modify the C++ code.</p><p>To ensure that the native code can be compiled properly, make sure that the <code>Use Custom</code> option in the <code>Native Module</code> is selected.</p><h3 id="compiling-in-cocos-creator" tabindex="-1">Compiling in Cocos Creator <a class="header-anchor" href="#compiling-in-cocos-creator" aria-label="Permalink to &quot;Compiling in Cocos Creator&quot;">​</a></h3><p>After modifying the engine, open the <strong>Build</strong> panel, click <strong>Build</strong>, and after the build is complete, click <strong>Make</strong> to Compile.</p><h3 id="compiling-in-an-ide" tabindex="-1">Compiling in an IDE <a class="header-anchor" href="#compiling-in-an-ide" aria-label="Permalink to &quot;Compiling in an IDE&quot;">​</a></h3><p>After configuring the custom engine path for the first time, you need to click the <code>Build</code> button in the <strong>Build</strong> panel to synchronize the relevant configuration to your IDE (such as Xcode, Android Studio, Visual Studio, etc.).</p><p>The engine code used by the IDE project will then reference to the custom engine.</p><p>From now on, each time when you modify the native engine code, you can compile it using IDE directly.</p><h2 id="rebuild-the-native-engine-simulator" tabindex="-1">Rebuild the Native Engine Simulator <a class="header-anchor" href="#rebuild-the-native-engine-simulator" aria-label="Permalink to &quot;Rebuild the Native Engine Simulator&quot;">​</a></h2><p>Cocos Creator provides a feature to preview in a simulator based on the native engine.</p><p><img src="'+p+`" alt="custom-native-simulator"></p><h3 id="modified-typescript-engine" tabindex="-1">Modified TypeScript Engine <a class="header-anchor" href="#modified-typescript-engine" aria-label="Permalink to &quot;Modified TypeScript Engine&quot;">​</a></h3><p>If you are using custom TypeScript engine, the native simulator will attempt to load the TS engine modules under <code>custom-engine-path/native/simulator/</code>.</p><p>The first time you launch the simulator in this situation, you need to click <strong>Developer-&gt; Rebuild Native Simulator Engine</strong> in the top menu bar, otherwise, the TS engine modules will not be loaded successfully.</p><h3 id="modified-native-c-engine" tabindex="-1">Modified Native(C++) Engine <a class="header-anchor" href="#modified-native-c-engine" aria-label="Permalink to &quot;Modified Native(C++) Engine&quot;">​</a></h3><p>If you have selected to use a custom native engine, Cocos Creator will launch the simulator located at <code>custom-engine-path/native/simulator/</code> when previewing in simulator.</p><p>To avoid a large installation package, Cocos Creator excludes the native simulator project before publishing. Therefore, you need to follow these steps to configure the environment and rebuild it,otherwise, the simulator won&#39;t start.</p><h3 id="installing-and-configuring-cmake" tabindex="-1">Installing and Configuring CMake <a class="header-anchor" href="#installing-and-configuring-cmake" aria-label="Permalink to &quot;Installing and Configuring CMake&quot;">​</a></h3><blockquote><p>Cocos Creator comes with its own CMake and has configured the paths, so you don&#39;t need to do additional configuration when building, compiling, and publishing your project.</p></blockquote><p>The compilation of the native simulator is not part of the build process, so you need to configure the CMake environment yourself.</p><p>Since there are so many differences among different system, platforms, and versions, please refer to the <a href="https://cmake.org/install/" target="_blank" rel="noreferrer">CMake official website</a> for installing CMake and configuring the system environment variables.</p><h3 id="compilation" tabindex="-1">Compilation <a class="header-anchor" href="#compilation" aria-label="Permalink to &quot;Compilation&quot;">​</a></h3><p>After configuring <code>CMake</code>, navigate to the <code>custom-engine-path/native/</code> folder and execute the following commands.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install the required modules</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># compile and generate native simulator</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gulp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gen-simulator</span></span></code></pre></div><p>After the compilation is complete, a simulator project and an executable application will be generated under the <code>custom-engine-path/native/simulator/</code> directory. You can then run the <strong>Preview in Simulator</strong>.</p><p>Once the native simulator is successfully compiled and generated, if you only make changes to the TypeScript part, you only need to click <strong>Developer-&gt;Rebuild the Native Simulator Engine</strong> to make it in effect.</p>`,90),m=[u];function f(k,y,b,v,C,E){return n(),t("div",null,m)}const _=e(g,[["render",f]]);export{q as __pageData,_ as default};
