import{_ as s,v as n,b as a,R as l}from"./chunks/framework.5ffcbaff.js";import{_ as p}from"./chunks/ui-select.3567cefe.js";const o="/docs/cocos/assets/create-sprite.cd4d1f60.png",e="/docs/cocos/assets/2d-create-guild.d3acd8a2.png",t="/docs/cocos/assets/create-asset.91eb6f22.png",c="/docs/cocos/assets/custom-material.8968a615.png",r="/docs/cocos/assets/2d-gradient-vs.12f0017a.png",F="/docs/cocos/assets/check-use-texture.2c96dc3d.png",y="/docs/cocos/assets/adjust-gradient-color.01885d30.png",D="/docs/cocos/assets/view-x-gradient.c4a75782.png",C="/docs/cocos/assets/macro-preview.47adc0b4.png",S=JSON.parse('{"title":"2D 精灵着色器：Gradient","description":"","frontmatter":{},"headers":[],"relativePath":"zh/manual/shader/write-effect-2d-sprite-gradient.md","filePath":"zh/manual/shader/write-effect-2d-sprite-gradient.md"}'),i={name:"zh/manual/shader/write-effect-2d-sprite-gradient.md"},A=l('<h1 id="_2d-精灵着色器-gradient" tabindex="-1">2D 精灵着色器：Gradient <a class="header-anchor" href="#_2d-精灵着色器-gradient" aria-label="Permalink to &quot;2D 精灵着色器：Gradient&quot;">​</a></h1><p>默认的情况下，UI 和 2D 组件会使用引擎内置的着色器，这些着色器放在 <strong>资源管理器</strong> 面板的 <strong>internal -&gt; effects</strong> 目录下，可查看 <a href="./effect-builtin.html">内置着色器</a> 来了解其作用。</p><p>对于任何持有 CustomMaterial 属性的 UI 和 2D 组件，都可在 <strong>属性检查器</strong> 内通过该属性的下拉框选择或者从 <strong>资源管理器</strong> 内拖拽实现自定义材质。</p><p>引擎规定 UI 组件的自定义材质只能有一个。</p><p><img src="'+p+'" alt="内置的 UI 着色器"></p><blockquote><p><strong>注意</strong>：</p><ol><li>在使用自定义材质后，可能会打断合批。</li><li>关于 UI 和 2D 组件合批的使用，可以参考：<a href="./../ui-system/components/engine/ui-batch.html">2D 渲染组件合批规则说明</a></li></ol></blockquote><p>本文将通过实现一个精灵的渐变着色器来演示如何为 UI 和 2D 组件使用自定义着色器。</p><h2 id="搭建工程" tabindex="-1">搭建工程 <a class="header-anchor" href="#搭建工程" aria-label="Permalink to &quot;搭建工程&quot;">​</a></h2><p>通过 CocosDashBoard 创建一个新的 2D 项目。</p><p>创建一个新的场景并在场景内添加一个 Sprite：</p><p><img src="'+o+'" alt="create sprite"></p><p>在 <strong>资源管理器</strong> 内执行以下的操作：</p><ul><li>创建名为 gradient.effect 的着色器文件</li><li>拷贝 <strong>资源管理器 -&gt; intenal -&gt; effects</strong> 内的 <code>builtin-sprite</code> 着色器的内容到 gradient.effect 内</li><li>创建名为 gradient.mtl 的材质并在 <strong>属性查看器</strong> 内的 Effect 栏选择 gradient.effect</li><li>导入任意的纹理</li></ul><p>材质和着色器的创建可通过在 <strong>资源管理器</strong> 内任意空白处点击鼠标右键，或单击 <strong>资源管理</strong> 上的 <code>+</code> 按钮</p><p><img src="'+e+'" alt="create-mtl-effect"></p><p>创建好的工程如图示：</p><p><img src="'+t+'" alt="create asset"></p><p>选中创建好的精灵，将 gradient.mtl 材质和导入的纹理分别赋予给精灵的对应属性：</p><p><img src="'+c+`" alt="custom-material"></p><h2 id="cceffect" tabindex="-1">CCEffect <a class="header-anchor" href="#cceffect" aria-label="Permalink to &quot;CCEffect&quot;">​</a></h2><p>通过观察可得知，渐变可以理解为在某个轴上，随着坐标变化，颜色发生变化的现象。因此在 CCEffect 段内给着色器的 properties 增加两个颜色属性分别代表渐变的起始颜色和结束颜色。</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">startColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># gradientA 的 RGBA 通道的默认值</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">editor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">color</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 在属性查看器内展示的样式，此处展示为颜色</span></span>
<span class="line"><span style="color:#F07178;">endColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">editor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">color</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>此时的 CCEffect:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C3E88D;">CCEffect %{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">techniques</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">passes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">vert</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sprite-vs:vert</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">frag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sprite-fs:frag</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">depthStencilState</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">depthTest</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">depthWrite</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">blendState</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targets</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">blend</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">blendSrc</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src_alpha</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">blendDst</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one_minus_src_alpha</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">blendDstAlpha</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one_minus_src_alpha</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">rasterizerState</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">cullMode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">none</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">properties</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">alphaThreshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">startColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">editor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">color</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">endColor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">editor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">color</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}%</span></span></code></pre></div><p>注意这里定义了两个颜色值 <code>startColor</code> 和 <code>endColor</code>，如果要将这两个颜色正确的传入给着色器片段，则需要增加对应的 Uniform。</p><p>引擎规定，不允许离散使用 Uniform，因此在 <code>CCProgram sprite-fs</code> 段内添加下列的代码：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">uniform</span><span style="color:#A6ACCD;"> Constant</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    vec4 startColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    vec4 endColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>此时引擎会自动将 <code>properties</code> 内定义的属性和 <code>Constant</code> 内的 Uniform 进行关联。</p><h2 id="顶点着色器" tabindex="-1">顶点着色器 <a class="header-anchor" href="#顶点着色器" aria-label="Permalink to &quot;顶点着色器&quot;">​</a></h2><p>通常不用对顶点着色器做额外的处理，因此保留系统内置的 <code>sprite-vs</code>。</p><p><img src="`+r+`" alt="顶点着色器"></p><h2 id="片元着色器" tabindex="-1">片元着色器 <a class="header-anchor" href="#片元着色器" aria-label="Permalink to &quot;片元着色器&quot;">​</a></h2><p>在默认的精灵着色器内，精灵顶点的 XY 轴和纹理坐标的 UV 是对应的，因此可考虑使用纹理坐标的变化来达成渐变，在 USE_TEXTURE 宏定义的范围内增加下列代码：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">USE_TEXTURE</span><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">    o </span><span style="color:#89DDFF;">*=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CCSampleWithAlphaSeparated</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">cc_spriteTexture</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> uv0</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">IS_GRAY</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">float</span><span style="color:#A6ACCD;"> gray  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2126</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> o.r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.7152</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> o.g </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0722</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> o.b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    o.r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.g </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gray</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 根据 UV 的变化来调整渐变色</span></span>
<span class="line"><span style="color:#A6ACCD;">    o.rgb </span><span style="color:#89DDFF;">*=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0.x</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;">.rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#endif</span></span></code></pre></div><p>勾选原有材质上的 <code>USE_TEXTURE</code> 选项：</p><p><img src="`+F+'" alt="use-texture"></p><p>此时通过调整材质上的 <strong>startColor</strong> 和 <strong>endColor</strong> 则可以观察到不同的渐变：</p><p><img src="'+y+'" alt="material-color"></p><p>精灵着色的变化：</p><p><img src="'+D+`" alt="preview"></p><h2 id="使用预处理宏定义" tabindex="-1">使用预处理宏定义 <a class="header-anchor" href="#使用预处理宏定义" aria-label="Permalink to &quot;使用预处理宏定义&quot;">​</a></h2><p>在上述的片元着色器内，只考虑了纹理坐标轴 U 的渐变，为了灵活性和支持更多的功能，通过预处理宏定义来实现不同轴的渐变，因此删掉下列代码：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">o.rgb </span><span style="color:#89DDFF;">*=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0.x</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;">.rgb</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>添加下列代码：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">USE_HORIZONTAL</span></span>
<span class="line"><span style="color:#A6ACCD;">    o.rgb </span><span style="color:#89DDFF;">*=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0.x</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;">.rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">USE_VERTICAL</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    o.rgb </span><span style="color:#89DDFF;">*=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0.y</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;">.rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#endif</span></span></code></pre></div><p>这里声明了 <code>USE_HORIZONTAL</code> 和 <code>USE_VERTICAL</code> 这两个预处理宏定义，分别代表了水平方向和垂直方向的渐变，可以方便地按需使用：</p><p><img src="`+C+`" alt="macro-preview"></p><p>完整的着色器代码：</p><div class="language-glsl"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.</span></span>
<span class="line"><span style="color:#A6ACCD;">CCEffect </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">  techniques:</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> passes:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> vert: sprite</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">vs:vert</span></span>
<span class="line"><span style="color:#F07178;">      frag: sprite</span><span style="color:#89DDFF;">-</span><span style="color:#F07178;">fs:frag</span></span>
<span class="line"><span style="color:#F07178;">      depthStencilState:</span></span>
<span class="line"><span style="color:#F07178;">        depthTest: </span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#F07178;">        depthWrite: </span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#F07178;">      blendState:</span></span>
<span class="line"><span style="color:#F07178;">        targets:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> blend: </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#F07178;">          blendSrc: src_alpha</span></span>
<span class="line"><span style="color:#F07178;">          blendDst: one_minus_src_alpha</span></span>
<span class="line"><span style="color:#F07178;">          blendDstAlpha: one_minus_src_alpha</span></span>
<span class="line"><span style="color:#F07178;">      rasterizerState:</span></span>
<span class="line"><span style="color:#F07178;">        cullMode: none</span></span>
<span class="line"><span style="color:#F07178;">      properties:</span></span>
<span class="line"><span style="color:#F07178;">        alphaThreshold: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value: </span><span style="color:#F78C6C;">0.5</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        startColor: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value: </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> editor: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type: color</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        endColor: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value: </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> editor: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">type: color</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CCProgram sprite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">vs </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">  precision highp </span><span style="color:#C792EA;">float</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">builtin/uniforms/cc-global</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_LOCAL</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">builtin/uniforms/cc-local</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">SAMPLE_FROM_RT</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">common/common-define</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"><span style="color:#F07178;">  in vec3 a_position</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  in vec2 a_texCoord</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  in vec4 a_color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  out vec4 color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  out vec2 uv0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  vec4 </span><span style="color:#82AAFF;">vert</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    vec4 pos </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">a_position</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_LOCAL</span></span>
<span class="line"><span style="color:#F07178;">      pos </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> cc_matWorld </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> pos</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_PIXEL_ALIGNMENT</span></span>
<span class="line"><span style="color:#F07178;">      pos </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> cc_matView </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> pos</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">pos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">xyz</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">floor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">xyz</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">      pos </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> cc_matProj </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> pos</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#else</span></span>
<span class="line"><span style="color:#F07178;">      pos </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> cc_matViewProj </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> pos</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    uv0 </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> a_texCoord</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">SAMPLE_FROM_RT</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">CC_HANDLE_RT_SAMPLE_FLIP</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">uv0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"><span style="color:#F07178;">    color </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> a_color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> pos</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CCProgram sprite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">fs </span><span style="color:#89DDFF;">%{</span></span>
<span class="line"><span style="color:#F07178;">  precision highp </span><span style="color:#C792EA;">float</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">builtin/internal/embedded-alpha</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">builtin/internal/alpha-test</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  in vec4 color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  uniform Constant</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    vec4 startColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    vec4 endColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span><span style="color:#F07178;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_TEXTURE</span></span>
<span class="line"><span style="color:#F07178;">    in vec2 uv0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#pragma</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">builtin</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">local</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">layout</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">set </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> binding </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> uniform sampler2D cc_spriteTexture</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  vec4 </span><span style="color:#82AAFF;">frag</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    vec4 o </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_TEXTURE</span><span style="color:#F07178;">            </span></span>
<span class="line"><span style="color:#F07178;">      o </span><span style="color:#89DDFF;">*=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CCSampleWithAlphaSeparated</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">cc_spriteTexture</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> uv0</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">IS_GRAY</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">float</span><span style="color:#F07178;"> gray  </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.2126</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">r</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.7152</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">g</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.0722</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">r</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">g</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> gray</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_HORIZONTAL</span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">rgb</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">)).</span><span style="color:#A6ACCD;">rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#if</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">USE_VERTICAL</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">         </span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">rgb</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">mix</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">startColor</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> endColor</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">vec4</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uv0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">)).</span><span style="color:#A6ACCD;">rgb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">#endif</span><span style="color:#F07178;">      </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    o </span><span style="color:#89DDFF;">*=</span><span style="color:#F07178;"> color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">ALPHA_TEST</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">o</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> o</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}%</span></span></code></pre></div>`,49),d=[A];function f(g,u,m,h,_,v){return n(),a("div",null,d)}const U=s(i,[["render",f]]);export{S as __pageData,U as default};
