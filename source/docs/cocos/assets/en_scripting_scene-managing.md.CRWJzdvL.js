import{_ as e,c as s,o as a,a4 as i}from"./chunks/framework.uQk9_EO2.js";const E=JSON.parse('{"title":"Loading and Switching Scenes","description":"","frontmatter":{},"headers":[],"relativePath":"en/scripting/scene-managing.md","filePath":"en/scripting/scene-managing.md","lastUpdated":1712305443000}'),t={name:"en/scripting/scene-managing.md"},n=i(`<h1 id="loading-and-switching-scenes" tabindex="-1">Loading and Switching Scenes <a class="header-anchor" href="#loading-and-switching-scenes" aria-label="Permalink to &quot;Loading and Switching Scenes&quot;">​</a></h1><p><strong>Cocos Creator</strong> uses the scene&#39;s file name (without extension) to index the scene. Loading and switching scenes is performed using the <code>loadScene()</code> API. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyScene&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>In addition, as of v2.4, the Asset Bundle has added a new loading method:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bundle.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;MyScene&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(scene);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>The <code>loadScene</code> provided by the Asset Bundle will only load scenes from the specified bundle and will not automatically run the scenes, you also need to use <code>director.runScene</code> to run the scenes.<br><code>loadScene</code> also provides more parameters to control the loading process, so developers can control the loading parameters themselves or do some processing after the loading scene.</p><p>For more information about loading scenes in the Asset Bundle, you can refer to the <a href="./../asset/bundle">Asset Bundle</a> documentation.</p><h2 id="scene-resource-management-and-persistent-nodes" tabindex="-1">Scene resource management and Persistent Nodes <a class="header-anchor" href="#scene-resource-management-and-persistent-nodes" aria-label="Permalink to &quot;Scene resource management and Persistent Nodes&quot;">​</a></h2><p>The engine will only run one scene at the same time. When switching scenes, all nodes and other instances in the scene will be destroyed by default. Developer&#39;s may need to use a component to control the loading of all scenes, or to transfer parameter data between scenes, mark the node where the component is located as a <strong>Persistent Node</strong> so that it will not be automatically destroyed when the scene is switched, and will remain in memory. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addPersistRootNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myNode);</span></span></code></pre></div><p>The above interface will turn <code>myNode</code> into a persistent node, so that the components attached to it can continue to function between scenes. This method can be used to store player information, or various things needed for the initialization of the next scene data.</p><blockquote><p><strong>Note</strong>: the target node must be the root node in the hierarchy, otherwise the setting is invalid.</p></blockquote><p>Cancelling the persistece of a node is easy. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removePersistRootNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myNode);</span></span></code></pre></div><blockquote><p><strong>Note</strong>: the above API does not immediately destroy the specified node, but restores the node to a node that can be destroyed when the scene is switched.</p></blockquote><h2 id="scene-loading-callback" tabindex="-1">Scene loading callback <a class="header-anchor" href="#scene-loading-callback" aria-label="Permalink to &quot;Scene loading callback&quot;">​</a></h2><p>When loading a scene, you can attach a parameter to specify the callback function after the scene is loaded. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyScene&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, onSceneLaunched);</span></span></code></pre></div><p><code>onSceneLaunched</code> is a callback function declared in this script, and can be used for further initialization or data transfer operations after the scene is loaded.</p><p>Since the callback function can only be written in this script, the scene loading callback is usually used in conjunction with the persistent node and used in the script mounted on the persistent node.</p><h2 id="preloading-a-scene" tabindex="-1">Preloading a scene <a class="header-anchor" href="#preloading-a-scene" aria-label="Permalink to &quot;Preloading a scene&quot;">​</a></h2><p><code>director.loadScene</code> will automatically switch to run the new scene after loading the scene. It is also possible to silently load the new scene in the background and switch manually after the loading is complete. Use the <code>preloadScene</code> interface to preload the scene in advance. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preloadScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;table&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Next scene preloaded&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Then call <code>loadScene</code> at an appropriate time to switch scenes. Example:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">director.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadScene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;table&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><blockquote><p><strong>Note</strong>: if the preloading is not complete, you can also call <code>director.loadScene()</code> directly, and the scene will start after the preloading is complete.</p></blockquote>`,26),o=[n];function l(h,d,c,p,r,k){return a(),s("div",null,o)}const u=e(t,[["render",l]]);export{E as __pageData,u as default};
