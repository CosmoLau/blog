import{_ as t}from"./chunks/cubemap-properties.BLtMx6sf.js";import{_ as s,c as o,o as e,a4 as r}from"./chunks/framework.uQk9_EO2.js";const n="/docs/cocos/assets/enable-skybox.-ZKJxo_z.jpg",a="/docs/cocos/assets/envmap.C23fPPkF.png",g="/docs/cocos/assets/texturecube.CfNhCesN.png",l="/docs/cocos/assets/set-envmap.1J4hkaQc.png",i="/docs/cocos/assets/builtin.Dl8O1jIl.png",p="/docs/cocos/assets/skybox-camera.k0Vylvgz.png",c="/docs/cocos/assets/cubemap-texture-type.CtfCH5at.png",d="/docs/cocos/assets/create-cubemap.CTp16s0G.png",m="/docs/cocos/assets/sky-box-type.Bm0J1wXK.png",u="/docs/cocos/assets/hemisphere.DPYIMcKB.png",b="/docs/cocos/assets/autogen-hemisphere.D6Loh9ks.png",h="/docs/cocos/assets/diffuse-map-with-reflection.Bgrs-9OI.png",A="/docs/cocos/assets/compare.X9M9x5yO.gif",x="/docs/cocos/assets/use-hdr.XQO-uAwj.png",f="/docs/cocos/assets/material.DBKfmvgN.png",y="/docs/cocos/assets/custom-skybox-material.BlDqIyLD.png",C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAfCAIAAAAwU+mAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAJJSURBVFiF7Zg/i9pgHMe/ueQwJVpFQW9JFjPoEIgOneIkiOAiV1+C3NQuFu5FCHVpp8OXYMVFkEC3TDdIQCgdIpQIUiXKWXMQuRM7RO0fSiuPB2nAz/Q84ffwfJ7k+zyEh0qn0/AnZ14LkHNS9wKGZVkuHKHWj16bHMSGZu4Xd47jAGC4cIR++YpK8F5bHcRmMuI+vHecrwDOqPWjX7wBUAl+HxAfZ/2k7gU+VmcIxtTycjH0o2tb40tt+ufSpNiWGK3zuUEk93dI1AFgOSt8HAGuXKKenF4Pn9DqIEjV9wy/GalgNOx2+GY5JrjN/dp21PJykbVvukYrKbalYBAAnN4RH+TorCefi+fOpz6AeL0Ui1rjQkcvDGw7FKknf/FWVuNC12iBb0rBuakXOnpvyRZLYoV0ZtK3Hoqp5ZjbNE29AQDT6+4u8cPVXHq2r71QJBmzgrsfspwAp9cHgMYXW5EYgdDg+KwjXi/JbWV8qU2RTakCu6tYz7cNVoRthrgasMsGWyzLxV3ZRRIg2idHZx3T20VCDgQAvimwpqlX+wD4ZjmyK3A0zTAV6SrPN9zVPtg3XaN19MTHn+vxF2HaXq1+flRRIr/FoKXdmW76+/fmebCYdcsktZyqkU78BFnHcpvjnhW5EmRVgG3N9IdYNAws9gNGVZNTU2JlaFQHgbYkqwKAtT4gP2GoXC5Hv35LOtwD1u/eWJYFX/8InNS94KTuBWcbmtlMRv8u/D/YTEYbenugU5lMxq+XGY7juHcDvsPPWfdagJzvwgrTfRWl0ZAAAAAASUVORK5CYII=",E="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAAfCAIAAADP8cxiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAALtSURBVFiF7ZgxaBpRHMY/ozboFXsJveAlYpRk8Ia4hB44pJRyYJfDbqaj4hIouNTJ2clJCGQRHRtHcemBUzIUDrKYQYeES4LtSYV4OaJHaqUd7qQZ2kSMIoo/HN579/7H971737tDE8MwmF0WJi1gvMztTTMWl9XmXyRNk9YxJiz+RfKNg1qyWCetZCwsmIBZ9YaZz97c3jQz4/YsQ9R4D3KU6/5AR81+rBVHpGikDGMPAOrH4l5ebzpT++4PCWcx3RiZqpExrL17NMTLNT9p0zuhxHaMMQOA3OSTEoB4ig0oaotxuADIzayyHGPMQK9SOEkK0CdwNAC0q1e76UY8xQaUq910w7gbec0nJQR9h2EHAQBaOXqaGVTbCLLnZNfNbUUDgMhWjPlZjop8tFmnqcOEU59BMNZaVOQLapumYuQ1HxXLstn/2qsb4GitHBX5ggrGfRBB5kwj1slQ/871MwnwHoQdrWORj4pl2cbt+0LjtufaYUs5/ef23zT1xY5v2iDfZgBA+lLtEf1HagwKdy30KkcSgAulp1/xkOZ2tZkBINS+ynBtevG927YTbBAIkht2rZYHIs9d0Gp5AMgcqW271TOozCdmL+g7DBPnR9LfCzRVylFGu7OoL7PxbP+Bc+UFoBidC6UHEhCUc96xvIrQS4KQr/v70MblWM5o91aCgDCIzCdmT6h99m/HwltxwciDnp/7U+IP1Td+3Lg3+h0PadYHxcu12KbXA31nAhj6cH5y9orpb5WOLZBwAsicaQRDxQHAmdpnSynvo+UXSs8oCfoCNHQ/xUq7TVMcbWxI5G/rdse7CACEEtul3NaDS3afERwtjeSJRjBrqSCQP81Wn3F6IKFmk9KjxcX0SVm2cTm2FHagemW8bATlvNNPLABIewV1aYct5dgYg0ph8JPT9OnV2/fLq0P5mgJm/KNsbm+amdubZhZ+A61f3UnLGBeWyp0CFTP7R2C9q9W7//sknHpmPXuTFjBe/gCGbRYSTRcEXgAAAABJRU5ErkJggg==",_="/docs/cocos/assets/convolution-map.UoaXVYWm.gif",B=JSON.parse('{"title":"天空盒","description":"","frontmatter":{},"headers":[],"relativePath":"zh/concepts/scene/skybox.md","filePath":"zh/concepts/scene/skybox.md","lastUpdated":1712305443000}'),I={name:"zh/concepts/scene/skybox.md"},R=r('<h1 id="天空盒" tabindex="-1">天空盒 <a class="header-anchor" href="#天空盒" aria-label="Permalink to &quot;天空盒&quot;">​</a></h1><p>游戏中的天空盒是一个包裹整个场景的立方体，可以很好地渲染并展示整个场景环境，在基于 PBR 的工作流中天空盒也可以贡献非常重要的 IBL 环境光照。</p><h2 id="开启天空盒" tabindex="-1">开启天空盒 <a class="header-anchor" href="#开启天空盒" aria-label="Permalink to &quot;开启天空盒&quot;">​</a></h2><p>在 <strong>层级管理器</strong> 中选中场景根节点，然后在 <strong>属性检查器</strong> 的 <strong>Skybox</strong> 组件中勾选 <strong>Enabled</strong> 属性即可开启天空盒。</p><p><img src="'+n+'" alt="Enable SkyBox"></p><p>Skybox 组件属性如下：</p><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Enabled</strong></td><td style="text-align:left;">勾选该项即可开启天空盒</td></tr><tr><td style="text-align:left;"><strong>Env Lighting Type</strong></td><td style="text-align:left;">环境光类型，请参考下文 <strong>漫反射照明</strong> 获取更多参考</td></tr><tr><td style="text-align:left;"><strong>UseHDR</strong></td><td style="text-align:left;">若勾选该项则开启 HDR（高动态范围），若不勾选该项，则使用 LDR（低动态范围）。详情请参考下文 <strong>切换 HDR/LDR 模式</strong> 部分的内容。</td></tr><tr><td style="text-align:left;"><strong>Envmap</strong></td><td style="text-align:left;">天空盒的环境贴图，<a href="./../../asset/texture-cube">TextureCube</a> 类型，具体设置方法可参考下文介绍。<br>当该属性为空时，天空盒默认使用和显示的是像素贴图</td></tr><tr><td style="text-align:left;"><strong>Reflection Convolution</strong></td><td style="text-align:left;">点击bake按钮后会生成一张低分辨率的环境贴图并且会对此图进行卷积计算，卷积图用于环境反射</td></tr><tr><td style="text-align:left;"><strong>Reflection Map</strong></td><td style="text-align:left;">自动生成的用于环境反射的卷积图，不支持手动编辑。渲染效果参考下文 <strong>烘焙反射卷积图</strong> 部分的内容。</td></tr><tr><td style="text-align:left;"><strong>DiffuseMap</strong></td><td style="text-align:left;">自动生成的用于高级漫反射的卷积图，不支持手动编辑。<br> 该选项只在 <strong>Env Lighting Type</strong> 为 <strong>DIFFUSEMAP_WITH_REFLECTION</strong> 时生效</td></tr><tr><td style="text-align:left;"><strong>Reflection Convolution</strong></td><td style="text-align:left;">反射卷积，详情请参考下方 <strong>反射卷积</strong> 部分</td></tr><tr><td style="text-align:left;"><strong>SkyboxMaterial</strong></td><td style="text-align:left;">为天空盒添加自定义的材质。请参考下方 <strong>天空盒材质</strong> 部分</td></tr></tbody></table><h2 id="设置天空盒的环境贴图" tabindex="-1">设置天空盒的环境贴图 <a class="header-anchor" href="#设置天空盒的环境贴图" aria-label="Permalink to &quot;设置天空盒的环境贴图&quot;">​</a></h2><p>开启天空盒之后还需要设置天空盒的环境贴图，用于在场景中产生环境光照。将贴图资源拖拽到 Skybox 组件的 <strong>Envmap</strong> 属性框中，或者点击 <strong>Envmap</strong> 属性框后面的箭头按钮选择所需的贴图资源即可。若不设置，则天空盒默认使用和显示的是像素贴图。</p><p><img src="'+a+'" alt="envmap"></p><p>天空盒的环境贴图资源支持：</p><ol><li><p>TextureCube 类型的单张贴图，可在 Creator 中设置。</p><ul><li><p>Cube Cross 图片</p></li><li><p>PNG 或 HDR 格式的图片</p></li></ul></li><li><p>图片文件形式的 CubeMap（立方体贴图）</p></li><li><p>在 Creator 中手动创建的由六张 texture 类型的贴图组合而成的 CubeMap</p></li></ol><h3 id="通过设置-texturecube-类型的贴图资源" tabindex="-1">通过设置 TextureCube 类型的贴图资源 <a class="header-anchor" href="#通过设置-texturecube-类型的贴图资源" aria-label="Permalink to &quot;通过设置 TextureCube 类型的贴图资源&quot;">​</a></h3><ol><li><p>导入贴图资源，直接将图片资源拖拽到 <strong>资源管理器</strong> 面板即可。</p></li><li><p>选中导入的贴图资源，在右侧的 <strong>属性检查器</strong> 面板中将 <strong>Type</strong> 属性设置为 <strong>texture cube</strong>，然后点击右上角的绿色打钩按钮保存设置。</p><p><img src="'+g+'" alt="设置为 TextureCube"></p></li><li><p>在 <strong>层级管理器</strong> 中选中 <strong>Scene</strong>，然后将设置好的图片资源拖拽到 <strong>属性检查器</strong> 中 <strong>skybox</strong> 组件的 <strong>Envmap</strong> 属性框中：</p><p><img src="'+l+'" alt="设置天空盒的环境贴图"></p></li></ol><p>这样子就设置完成了，开发者可以直接在 <strong>场景编辑器</strong> 中看到设置后的天空盒的环境贴图。若贴图没有正确显示，需要检查 <strong>SkyIllum 参数</strong> 的值是否太低，或者 <strong>修改 Camera 的 Clear Flag</strong>。</p><h3 id="使用引擎内置的资源" tabindex="-1">使用引擎内置的资源 <a class="header-anchor" href="#使用引擎内置的资源" aria-label="Permalink to &quot;使用引擎内置的资源&quot;">​</a></h3><p>在 <strong>资源管理器 -&gt; internal</strong> 目录下，引擎提供了部分内置的 TextureCube 资源，开发者也可以根据上述步骤按需使用。</p><p><img src="'+i+'" alt="builtin skybox"></p><h4 id="skyillum-参数" tabindex="-1">SkyIllum 参数 <a class="header-anchor" href="#skyillum-参数" aria-label="Permalink to &quot;SkyIllum 参数&quot;">​</a></h4><p>在 <strong>层级管理器</strong> 中选中场景根节点，然后在 <strong>属性检查器</strong> 的 <strong>ambient</strong> 组件中即可看到 SkyIllum 参数，默认值为 20000。</p><p>若 SkyIllum 参数值设置 <strong>太低</strong> 可能会导致天空盒的环境贴图无法在 <strong>场景编辑器</strong> 中正确显示。一般情况下：</p><ul><li><p>当 SkyIllum 参数值小于 300 时，天空盒的环境贴图便无法正常显示。</p></li><li><p>当 SkyIllum 参数值为 5000 时，效果相当于月夜的光照强度。</p></li></ul><h4 id="修改-camera-的-clear-flag" tabindex="-1">修改 Camera 的 Clear Flag <a class="header-anchor" href="#修改-camera-的-clear-flag" aria-label="Permalink to &quot;修改 Camera 的 Clear Flag&quot;">​</a></h4><p>若 <strong>场景编辑器</strong> 中天空盒的环境贴图已经可以正确显示，但是在项目运行之后仍然没有生效，此时就需要修改 Camera 组件的 <strong>ClearFlag</strong> 属性为 <strong>SKYBOX</strong>：</p><p><img src="'+p+'" alt="skybox-camera"></p><h3 id="制作-cubemap-立方体贴图" tabindex="-1">制作 CubeMap（立方体贴图） <a class="header-anchor" href="#制作-cubemap-立方体贴图" aria-label="Permalink to &quot;制作 CubeMap（立方体贴图）&quot;">​</a></h3><p>可在 Creator 中手动通过六张普通贴图生成一张立方体贴图，操作步骤如下：</p><ol><li><p>在 <strong>资源管理器</strong> 中将准备好的六张贴图资源全部选中，然后在 <strong>属性检查器</strong> 中将这些贴图资源的 <strong>Type</strong> 属性批量设置为 <strong>texture</strong>，并点击右上角的绿色打钩按钮。</p><p><img src="'+c+'" alt="cubeMap-texture-type"></p></li><li><p>新建 CubeMap 资源。在 <strong>资源管理器</strong> 中选中要存放 CubeMap 的文件夹，点击左上角的 <strong>+</strong> 按钮，然后选择 <strong>CubeMap</strong> 即可。或者也可以右键点击要存放 CubeMap 的文件夹，选择 <strong>新建 -&gt; CubeMap</strong>。</p><p><img src="'+d+'" alt="create CubeMap"></p></li><li><p>将刚才设置为 texture 类型的 6 张贴图拖拽到 CubeMap 对应的属性框中，完成后点击右上方的绿色打钩按钮，这样就完成了一张 CubeMap。</p><p><img src="'+t+'" alt="Set CubeMap"></p><blockquote><p><strong>注意</strong>：</p><ol><li>CubeMap 中未设置贴图的属性框将使用默认资源进行填充。</li><li>CubeMap 中的 6 个属性框 <strong>不要使用同一张贴图</strong>，否则会导致某些平台无法正常显示。</li></ol></blockquote></li></ol><h3 id="漫反射照明" tabindex="-1">漫反射照明 <a class="header-anchor" href="#漫反射照明" aria-label="Permalink to &quot;漫反射照明&quot;">​</a></h3><p>Creator 支持以下三种方式的环境漫反射照明，可以在 <strong>Env Lighting Type</strong> 属性的下拉列表中进行选择。</p><p><img src="'+m+'" alt="type"></p><p>其类型与描述如下所示：</p><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>HEMISPHERE_DIFFUSE</strong></td><td style="text-align:left;">半球漫反射</td></tr><tr><td style="text-align:left;"><strong>AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION</strong></td><td style="text-align:left;">半球漫反射和环境反射</td></tr><tr><td style="text-align:left;"><strong>DIFFUSEMAP_WITH_REFLECTION</strong></td><td style="text-align:left;">漫反射卷积图和环境反射</td></tr></tbody></table><ol><li><p><strong>半球漫反射</strong>：当 <strong>Env Lighting Type</strong> 属性为 <strong>HEMISPHERE_DIFFUSE</strong> 时，使用半球光漫反射。该方式由 <strong>Ambient</strong> 组件中的 <strong>SkyLightingColor</strong> 和 <strong>GroundLightingColor</strong> 属性控制，渲染性能更高，但是细节度不够，照明方向性差。<strong>可手动调节，但可能会和环境贴图变得不统一</strong>。在此模式下，IBL 将不可用，环境贴图对反射不起作用。</p><p><img src="'+u+'" alt="ambient-diffuse"></p></li><li><p><strong>半球漫反射和环境反射</strong>：当 <strong>Env Lighting Type</strong> 属性为 <strong>AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION</strong> 时，该方式可以通过 <strong>Ambient</strong> 组件中的 <strong>SkyLightingColor</strong> 和 <strong>GroundLightingColor</strong> 属性控制漫反射。同时也会表达环境贴图所产生的镜面反射效果。</p><p><img src="'+b+'" alt="autogen-hemisphere"></p></li><li><p><strong>漫反射卷积图和环境反射</strong>：当 <strong>Env Lighting Type</strong> 属性为 <strong>DIFFUSEMAP_WITH_REFLECTION</strong> 时，使用卷积图漫反射。该方式是高级漫反射，可以正确表达环境贴图产生的漫反射照明，有较好的照明方向性和细节。但和 <strong>AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION</strong> 不同的是漫反射是由自动生成的卷积图来表达，不允许编辑。</p><p><img src="'+h+'" alt="apply-diffuseMap"></p></li></ol><p>通过下面的 GIF 图可以更明显地看到 <strong>AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION</strong> 与 <strong>DIFFUSEMAP_WITH_REFLECTION</strong> 的对比，在 <strong>Env Lighting Type</strong> 为 <strong>DIFFUSEMAP_WITH_REFLECTION</strong> 的情况下背光面较暗，突出了整体的层次感，明暗对比细节也有较大的提升。</p><p><img src="'+A+'" alt="Compare"></p><blockquote><p><strong>注意</strong>：当更换 <strong>Envmap</strong> 属性中的环境贴图时，Creator 会自动计算对应的环境光照信息，以及漫反射光照（仅支持图片文件形式的 CubeMap，不包括手动制作的 CubeMap）</p></blockquote><h2 id="切换-hdr-ldr-模式" tabindex="-1">切换 HDR/LDR 模式 <a class="header-anchor" href="#切换-hdr-ldr-模式" aria-label="Permalink to &quot;切换 HDR/LDR 模式&quot;">​</a></h2><p>Skybox 组件中的 <strong>UseHDR</strong> 选项用于切换 HDR/LDR 模式，当勾选时使用 HDR 模式。</p><p><img src="'+x+'" alt="use-hdr"></p><ul><li><p>HDR（High Dynamic Range）：高动态范围，配合 <strong>光源的光度学强度</strong> 和 <strong>相机的曝光参数</strong> 可以实现更真实的明暗对比层次。若使用该模式，则所有的光源（包括平行光、点光源、聚光灯等）<strong>强度会变成光度学物理单位</strong>，环境光立方体贴图应使用 <strong>HDR 格式的图片</strong> 以提供高动态范围的数据源。</p></li><li><p>LDR（Low Dynamic Range）：低动态范围。若使用该模式，则 <strong>光源强度会变成无单位</strong>，不再与光度学和相机曝光有任何联系。此模式适用于希望无任何色染的体现原贴图颜色的情景，环境光立方体贴图可使用 <strong>PNG 等格式的图片</strong>。</p></li></ul><h2 id="天空盒材质" tabindex="-1">天空盒材质 <a class="header-anchor" href="#天空盒材质" aria-label="Permalink to &quot;天空盒材质&quot;">​</a></h2><p><img src="'+f+'" alt="material"></p><p>天空盒材质默认使用的着色器是 <strong>资源管理器 -&gt; internal/pipeline/skybox.effect</strong>，如想自定义材质，可参考 <a href="./../../asset/material">新建材质</a> 创建新的材质并选择 <a href="./../../shader/write-effect-overview">自定义着色器</a>：</p><p><img src="'+y+'" alt="cusom skybox material"></p><h2 id="反射卷积" tabindex="-1">反射卷积 <a class="header-anchor" href="#反射卷积" aria-label="Permalink to &quot;反射卷积&quot;">​</a></h2><p>使用 GGX BRDF 光照模型对环境贴图生成预卷积的反射结果，在生成时会考虑粗糙度的影响，并将最终的结果按照粗糙度顺序存储在 Mipmap 中（粗糙度从 0 到 1，粗糙度为 0 时， Mipmap 等级为 0）。</p><p>由于该算法考虑了粗糙度对环境反射的影响（即随着粗糙度增加，环境反射更模糊），因此使 PBR 材质产生更加逼真的反射效果。</p><h2 id="烘焙反射卷积图" tabindex="-1">烘焙反射卷积图 <a class="header-anchor" href="#烘焙反射卷积图" aria-label="Permalink to &quot;烘焙反射卷积图&quot;">​</a></h2><p>在 <strong>属性检查器</strong> 内点击 <img src="'+C+'" alt="bake"> 按钮则可以进行反射卷积贴图的烘焙工作。在生成完成之后，也可以选择点击 <img src="'+E+'" alt="remove"> 按钮进行删除。</p><p>生成的环境反射卷积图会填充到 TextureCube 的 mipmaps，在 Shader 中根据材质粗糙度采样对应层级的 mipmap，从而提供更加真实的 IBL 效果，通过下面的 GIF 图可以明显看到对比效果。</p><p><img src="'+_+'" alt="Compare"></p>',52),k=[R];function H(T,F,S,M,D,P){return e(),o("div",null,k)}const L=s(I,[["render",H]]);export{B as __pageData,L as default};
