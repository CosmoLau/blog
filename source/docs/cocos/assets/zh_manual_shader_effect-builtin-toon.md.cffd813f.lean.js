import{_ as t,v as e,b as l,R as a}from"./chunks/framework.5ffcbaff.js";const s="/docs/cocos/assets/toon.3ef1c711.png",d="/docs/cocos/assets/toon-pass.57306864.png",o="/docs/cocos/assets/cull-front.1ad9ed21.png",n="/docs/cocos/assets/outline-on.59006e89.png",r="data:image/png;base64,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",i="/docs/cocos/assets/outline-off.9f8f63c9.png",f="/docs/cocos/assets/shade-color.d2344746.png",g="/docs/cocos/assets/shade-map.8266b295.png",A="/docs/cocos/assets/toon-surf.1bc9212d.png",z=JSON.parse('{"title":"卡通渲染","description":"","frontmatter":{},"headers":[],"relativePath":"zh/manual/shader/effect-builtin-toon.md","filePath":"zh/manual/shader/effect-builtin-toon.md"}'),x={name:"zh/manual/shader/effect-builtin-toon.md"},c=a('<h1 id="卡通渲染" tabindex="-1">卡通渲染 <a class="header-anchor" href="#卡通渲染" aria-label="Permalink to &quot;卡通渲染&quot;">​</a></h1><p>相对于 <a href="./effect-builtin-pbr.html">真实渲染</a>（Physical Based Rendering - PBR），非真实渲染（Non-Photorealistic Rendering - NPR）通过特性化渲染，实现与真实世界完全不同的美术表现。</p><p>卡通渲染（Toon Shading）是非真实渲染的常见效果之一。</p><p>通常卡通渲染的内容包含以下几个基础部分：</p><ul><li>对物体进行描边</li><li>降低色阶的数量并模拟色阶不连续现象</li><li>明暗色调分离</li><li>阴影形状干扰等</li></ul><p><img src="'+s+'" alt="toon"></p><h2 id="渲染过程" tabindex="-1">渲染过程 <a class="header-anchor" href="#渲染过程" aria-label="Permalink to &quot;渲染过程&quot;">​</a></h2><p>Cocos Creator 提供了内置卡通渲染着色器 <code>builtin-toon.effect</code>，以此为例，我们在材质资源中将 <strong>Effect</strong> 属性切换为 <code>builtin-toon.effect</code>，可以看到卡通渲染由两个渲染过程（Pass）组成：</p><p><img src="'+d+'" alt="渲染过程"></p><ul><li>渲染过程 0（Pass 0）：用于描边，默认不启用，可勾选右侧的 <strong>USE_OUTLINE_PASS</strong> 开启。</li><li>渲染过程 1（Pass 1）：正常渲染模型</li></ul><h3 id="渲染过程-0" tabindex="-1">渲染过程 0 <a class="header-anchor" href="#渲染过程-0" aria-label="Permalink to &quot;渲染过程 0&quot;">​</a></h3><p>渲染过程 0 会将光栅化状态中的剔除模式选择为正面剔除（<code>CullMode = FRONT</code>）并将模型的顶点沿法线进行扩张，由此得到一个比原模型较大的单色模型，之后 <strong>渲染过程 1</strong> 会正常渲染一次模型并遮盖住 <strong>渲染过程 0</strong> 的渲染结果，由于 <strong>渲染过程 1</strong> 的模型尺寸小于 <strong>渲染过程 0</strong> 的尺寸，因此会留下一个纯色的边缘形成描边。</p><p><img src="'+o+'" alt="cull-front"></p><p><strong>渲染过程 0</strong> 可通过勾选 <strong>USE_OUTLINE_PASS</strong> 开启或关闭。</p><p>当勾选 <strong>USE_OUTLINE_PASS</strong> 开启 <strong>渲染过程 0</strong> 的描边功能后，效果图如下：</p><p><img src="'+n+'" alt="USE_OUTLINE_PASS 开启"></p><p>若需要调整描边的深度效果，可通过 <strong>DepthBias</strong> 属性进行调整：</p><p><img src="'+r+'" alt="DepthBias"></p><p>当不勾选 <strong>USE_OUTLINE_PASS</strong> 关闭 <strong>渲染过程 0</strong> 的描边功能后，效果图如下：</p><p><img src="'+i+'" alt="USE_OUTLINE_PASS 关闭"></p><h3 id="渲染过程-1" tabindex="-1">渲染过程 1 <a class="header-anchor" href="#渲染过程-1" aria-label="Permalink to &quot;渲染过程 1&quot;">​</a></h3><p>卡通渲染的核心思路是通过降低色阶的数量，模拟器卡通中的赛璐璐（Celluloid）画风。</p><p>在着色器中将色阶降低为三个色阶，并通过三个颜色组成：</p><ul><li><strong>baseColor</strong>：基础颜色</li><li><strong>shadeColor1</strong>：一阶着色的颜色</li><li><strong>shadeColor2</strong>：二阶着色的颜色</li></ul><p>其颜色与编辑器材质属性的对应关系如下图：</p><p><img src="'+f+'" alt="toon-shade-color"></p><p>勾选 <strong>USE_1ST_SHADE_MAP</strong> 和 <strong>USE_2ND_SHADE_MAP</strong> 的情况下，使用外部进行纹理模拟色阶不连续现象。</p><p><img src="'+g+'" alt="shade map"></p><p>通过着色器的 <code>surf</code> 方法计算表面着色器（<code>ToonSurface</code>）的参数，并由 <code>CCToonShading</code> 方法计算最终的着色。</p><p><img src="'+A+'" alt="surf 代码"></p><h2 id="参数和预编译宏定义" tabindex="-1">参数和预编译宏定义 <a class="header-anchor" href="#参数和预编译宏定义" aria-label="Permalink to &quot;参数和预编译宏定义&quot;">​</a></h2><h3 id="渲染过程-0-1" tabindex="-1">渲染过程 0 <a class="header-anchor" href="#渲染过程-0-1" aria-label="Permalink to &quot;渲染过程 0&quot;">​</a></h3><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">lineWidth</td><td style="text-align:left;">描边的宽度</td></tr><tr><td style="text-align:left;">depthBias</td><td style="text-align:left;">描边的深度位移调整因子</td></tr><tr><td style="text-align:left;">baseColor</td><td style="text-align:left;">描边的颜色</td></tr></tbody></table><h3 id="渲染过程-1-1" tabindex="-1">渲染过程 1 <a class="header-anchor" href="#渲染过程-1-1" aria-label="Permalink to &quot;渲染过程 1&quot;">​</a></h3><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">tilingOffset</td><td style="text-align:left;">模型 UV 的缩放和偏移量，xy 对应缩放，zw 对应偏移</td></tr><tr><td style="text-align:left;">mainColor</td><td style="text-align:left;">主颜色，该颜色会作为最初的色阶</td></tr><tr><td style="text-align:left;">colorScale</td><td style="text-align:left;">颜色缩放，对主颜色，一阶和二阶颜色的 RGB 通道相乘</td></tr><tr><td style="text-align:left;">alphaThreshold</td><td style="text-align:left;">设置 Alpha 测试阀值，Alpha 值低于设定值的像素将被抛弃。该项仅在勾选 <strong>USE_ALPHA_TEST</strong> 后显示</td></tr><tr><td style="text-align:left;">shadeColor1</td><td style="text-align:left;">一阶色阶的颜色，该颜色会作为卡通着色的中间色阶</td></tr><tr><td style="text-align:left;">shadeColor2</td><td style="text-align:left;">二阶色阶的颜色，该颜色会作为卡通着色的最后一个色阶</td></tr><tr><td style="text-align:left;">specular</td><td style="text-align:left;">高光颜色</td></tr><tr><td style="text-align:left;">baseStep</td><td style="text-align:left;">一阶着色的步长</td></tr><tr><td style="text-align:left;">baseFeather</td><td style="text-align:left;">一阶着色和主颜色混合因子，和 <strong>BaseStep</strong> 属性配合调整一阶色阶所占比例以及混合的形式</td></tr><tr><td style="text-align:left;">shadeStep</td><td style="text-align:left;">二阶着色的步长</td></tr><tr><td style="text-align:left;">shadeFeather</td><td style="text-align:left;">二阶着色和一阶着色的混合因子，和 <strong>ShadeStep</strong> 属性配合调整二阶色阶所占比例以及混合的形式</td></tr><tr><td style="text-align:left;">shadowCover</td><td style="text-align:left;">阴影遮蔽因子</td></tr><tr><td style="text-align:left;">emissive</td><td style="text-align:left;">自发光颜色，独立于光照计算，由模型本身直接发散出的颜色</td></tr><tr><td style="text-align:left;">emissiveScale</td><td style="text-align:left;">自发光强度，用于控制自发光颜色对最终颜色的影响权重</td></tr><tr><td style="text-align:left;">normalStrength</td><td style="text-align:left;">法线伸缩量<br>只有在启用 USE_NORMAL_MAP 后才可以调整并对法线的 xy 轴进行缩放</td></tr><tr><td style="text-align:left;">normalMap</td><td style="text-align:left;">法线贴图 <br>只有在启用 USE_NORMAL_MAP 后才可以调整</td></tr><tr><td style="text-align:left;">mainTexture</td><td style="text-align:left;">主纹理，定义物体的基础纹理 <br> 编辑器内显示为 <strong>baseColorMap</strong>，需启用 USE_BASE_COLOR_MAP 宏才可以调整</td></tr><tr><td style="text-align:left;">shadeMap1</td><td style="text-align:left;">一阶色阶纹理，若指定则会和设定的 ShadeColor1 相乘。该项仅在勾选 <strong>USE 1ST SHADER MAP</strong> 后显示</td></tr><tr><td style="text-align:left;">shadeMap2</td><td style="text-align:left;">二阶色阶纹理，若指定则会和设定的 ShadeColor2 相乘。该项仅在勾选 <strong>USE 2ND SHADER MAP</strong> 后显示</td></tr><tr><td style="text-align:left;">specularMap</td><td style="text-align:left;">高光贴图，若指定了贴图，则会和高光颜色相乘。该项仅在勾选 <strong>USE SPECULAR MAP</strong> 后显示</td></tr><tr><td style="text-align:left;">emissiveMap</td><td style="text-align:left;">自发光贴图，若指定则会和自发光颜色相乘，因此需要将自发光颜色（默认是黑色）中的 RGBA 调高才会有效果。该项仅在勾选 <strong>USE EMISSIVE MAP</strong> 后显示</td></tr></tbody></table><h2 id="宏定义" tabindex="-1">宏定义 <a class="header-anchor" href="#宏定义" aria-label="Permalink to &quot;宏定义&quot;">​</a></h2><table><thead><tr><th style="text-align:left;">宏名</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">USE_INSTANCING</td><td style="text-align:left;">是否启用动态 instancing</td></tr><tr><td style="text-align:left;">USE_OUTLINE_PASS</td><td style="text-align:left;">是否启用描边 Pass</td></tr><tr><td style="text-align:left;">USE_NORMAL_MAP</td><td style="text-align:left;">是否使用法线贴图</td></tr><tr><td style="text-align:left;">USE_BASE_COLOR_MAP</td><td style="text-align:left;">是否使用基础贴图</td></tr><tr><td style="text-align:left;">USE_1ST_SHADE_MAP</td><td style="text-align:left;">是否使用贴图作为一阶色阶</td></tr><tr><td style="text-align:left;">USE_2ND_SHADE_MAP</td><td style="text-align:left;">是否使用贴图作为二阶色阶图</td></tr><tr><td style="text-align:left;">USE_EMISSIVE_MAP</td><td style="text-align:left;">是否使用自发光贴图</td></tr><tr><td style="text-align:left;">USE_ALPHA_TEST</td><td style="text-align:left;">是否进行半透明测试</td></tr><tr><td style="text-align:left;">USE_SPECULAR_MAP</td><td style="text-align:left;">是否使用高光贴图</td></tr><tr><td style="text-align:left;">BASE_COLOR_MAP_AS_SHADE_MAP_1</td><td style="text-align:left;">使用 baseColorMap 作为一阶着色</td></tr><tr><td style="text-align:left;">BASE_COLOR_MAP_AS_SHADE_MAP_2</td><td style="text-align:left;">使用 baseColorMap 作为二阶着色</td></tr><tr><td style="text-align:left;">SHADE_MAP_1_AS_SHADE_MAP_2</td><td style="text-align:left;">二阶着色是否和一阶着色叠加</td></tr></tbody></table>',37),h=[c];function y(p,S,u,E,b,P){return e(),l("div",null,h)}const m=t(x,[["render",y]]);export{z as __pageData,m as default};
